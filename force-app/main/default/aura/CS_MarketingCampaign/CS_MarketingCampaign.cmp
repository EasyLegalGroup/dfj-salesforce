<aura:component implements="force:appHostable" controller="CS_CostSystem_Controller" access="global">

    <aura:attribute name="campaignList" type="List" default="[]" access="global" />
    <aura:attribute name="picklistOptions" type="List" default="[]" access="global" />
    <aura:attribute name="selectedIndex" type="Integer" default="0" access="global" />
    <aura:attribute name="campaignIdToBeDeleted" type="string" default="" />
    <aura:attribute name="createCampaign" type="Boolean" default="false" />
    <aura:attribute name="openDeleteModal" type="Boolean" default="false" />
    <aura:attribute name="isEditing" type="Boolean" default="false" />
    <aura:attribute name="isSpinnerOpen" type="Boolean" default="false" />
    <aura:attribute name="campaignInstance" type="Marketing_Campaign__c" access="global" default="{'sobjectType':'Marketing_Campaign__c'}" />
    <aura:attribute name="openUnprocessedModal" type="Boolean" default="false" />
    <aura:attribute type="Datetime" name="fromDate" />
    <aura:attribute type="Datetime" name="toDate" />
    <aura:attribute type="String" name="buttonLabel" default="Reprocess" />
    <aura:attribute name="spendPeriodList" type="List" default="[]" access="global" description="spend Periods correspond to market campaign." />
    <aura:attribute name="filteredSpendPeriodList" type="List" default="[]" access="global" description="spend Periods correspond to market campaign." />

    <aura:handler name="init" value="{!this}" action="{!c.doInit}" />

    <div class="slds-card slds-p-around_small">
        <aura:if isTrue="{!v.isSpinnerOpen}">
            <div>
                <lightning:spinner variant="brand" size="large" alternativeText="Loading" />
            </div>
        </aura:if>

        <div>
            <aura:if isTrue="{!!v.isEditing}">
                <div class="slds-p-top_medium">
                    <div class="font-class slds-text-align_center" style="font-size: x-large;">
                        Marketing Campaigns
                    </div>
                    <lightning:layout multipleRows="true">
                        <lightning:layoutItem size="12" largeDeviceSize="12" mediumDeviceSize="12" smallDeviceSize="12" class="">
                            <table class="slds-table slds-table_bordered slds-table_striped slds-scrollable_x anotherhover" style="table-layout: fixed;">
                                <thead>
                                    <tr class="slds-line-height_reset">
                                        <th class="slds-text-title_caps slds-cell-wrap " scope="col" title="Name">
                                            <div class="slds-truncate slds-text-align_center ">Name</div>
                                        </th>
                                        <th class="slds-text-title_caps slds-cell-wrap " scope="col" title="Cost Category">
                                            <div class="slds-truncate slds-text-align_center slds-p-around_x-small"> Cost Category
                                            </div>
                                        </th>
                                        <th class="slds-text-title_caps slds-cell-wrap " scope="col" title="Action">
                                            <div class="slds-truncate slds-text-align_center slds-p-around_x-small">Action
                                            </div>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>

                                    <aura:if isTrue="{!v.campaignList.length == 0}">
                                        <tr class="slds-hint-parent">
                                            <th scope="row" colspan="3" class="slds-cell-wrap">
                                                <div class="slds-truncate slds-text-align_center slds-text-heading_small">
                                                    There are no campaign available.</div>
                                            </th>
                                        </tr>
                                        <aura:set attribute="else">
                                            <aura:iteration var="cp" items="{!v.campaignList}" indexVar="tabIndex">
                                                <tr class="slds-hint-parent ">
                                                    <td scope="row" class="slds-cell-wrap wrapWord" align="left">
                                                        <div class="slds-truncate slds-text-align_left slds-p-around_x-small">
                                                            <p class="slds-truncate slds-text-align_center">
                                                                <b>{!cp.Name}</b>
                                                            </p>
                                                        </div>
                                                    </td>
                                                    <td scope="row" class="slds-cell-wrap wrapWord" align="left">
                                                        <div class="slds-truncate slds-text-align_left slds-p-around_x-small">
                                                            <p class="slds-truncate slds-text-align_center">
                                                                <b>{!cp.Cost_Category__c}</b>
                                                            </p>
                                                        </div>
                                                    </td>
                                                    <td class="slds-truncate slds-text-align_center">
                                                        <lightning:buttonIcon alternativeText="Edit" iconName="utility:edit" variant="border" onclick="{!c.editMarketingCampaign}" title="Edit" tabindex="{!tabIndex}" name="EditMarketingCampaign" />
                                                        <lightning:buttonIcon iconName="utility:delete" variant="border" onclick="{! c.enableDeleteModal }" alternativeText="Delete" tabindex="{!tabIndex}" title="Delete" />
                                                        <lightning:buttonIcon iconName="utility:redo" variant="border" onclick="{! c.openCloseUnprocessedModal }" alternativeText="Reprocess" tabindex="{!tabIndex}" title="Reprocess" />

                                                    </td>
                                                </tr>
                                            </aura:iteration>
                                        </aura:set>
                                    </aura:if>
                                </tbody>
                            </table>
                        </lightning:layoutItem>
                    </lightning:layout>

                    <!-- Buton to create new Campaign record -->
                    <div class="slds-text-align_right button-padding slds-p-top_small">
                        <lightning:button class="slds-m-bottom_large" type="button" variant="brand" label="Create new marketing campaign" iconName="utility:add" iconPosition="left" onclick="{!c.openNewCampaignModel}" />
                    </div>

                    <!-- Delete Marketing campaign model -->
                    <div class="slds-p-around_medium">
                        <aura:if isTrue="{!v.openDeleteModal}">
                            <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
                                <div class="slds-modal__container" style="width:34%">
                                    <div class="slds-modal__content slds-p-around_small" id="modal-content-id-1">
                                        <lightning:layout multipleRows="true">
                                            <lightning:layoutItem size="12" largeDeviceSize="12" mediumDeviceSize="12" smallDeviceSize="12">
                                                <div class="slds-align_absolute-center slds-text-heading_medium slds-p-around_medium">
                                                    <p>Do you want to delete this marketing campaign?</p>
                                                </div>
                                            </lightning:layoutItem>
                                            <lightning:layoutItem size="6" largeDeviceSize="6" mediumDeviceSize="6" smallDeviceSize="6">
                                                <div align="right" class="slds-p-around_medium">
                                                    <lightning:button variant="brand" label="Yes" title="Yes" onclick="{! c.deleteCampaign }" iconName="utility:check" iconPosition="left" />
                                                </div>
                                            </lightning:layoutItem>
                                            <lightning:layoutItem size="6" largeDeviceSize="6" mediumDeviceSize="6" smallDeviceSize="6">
                                                <div align="left" class="slds-p-around_medium">
                                                    <lightning:button variant="brand" label="Cancel" title="Cancel" onclick="{! c.closeDeleteModal }" iconName="utility:close" iconPosition="left" />
                                                </div>
                                            </lightning:layoutItem>
                                        </lightning:layout>
                                    </div>

                                </div>
                            </section>
                            <div class="slds-backdrop slds-backdrop_open"></div>
                        </aura:if>
                    </div>

                    <!-- Process unprocessed leads model -->
                    <div class="slds-p-around_medium">
                        <aura:if isTrue="{!v.openUnprocessedModal}">
                            <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
                                <div class="slds-modal__container" style="width:34%">
                                    <div class="slds-modal__content slds-p-around_small" id="modal-content-id-1">
                                        <lightning:layout multipleRows="true">
                                            <lightning:layoutItem size="12" largeDeviceSize="12" mediumDeviceSize="12" smallDeviceSize="12">
                                                <div class="slds-align_absolute-center slds-text-heading_medium slds-p-around_medium">
                                                    <p>Process the Unprocessed leads</p>

                                                </div>
                                            </lightning:layoutItem>
                                            <lightning:layoutItem size="12" largeDeviceSize="12" mediumDeviceSize="12" smallDeviceSize="12">
                                                <div class="slds-p-around_medium">
                                                    <lightning:input type="datetime" name="From" label="From" value="{!v.fromDate}" />
                                                </div>
                                            </lightning:layoutItem>
                                            <lightning:layoutItem size="12" largeDeviceSize="12" mediumDeviceSize="12" smallDeviceSize="12">
                                                <div class="slds-p-around_medium">
                                                    <lightning:input type="datetime" name="To" label="To" value="{!v.toDate}" />
                                                </div>
                                            </lightning:layoutItem>
                                        </lightning:layout>
                                    </div>
                                    <footer class="slds-modal__footer">
                                        <lightning:button variant="brand" label="{!v.buttonLabel}" title="{!v.buttonLabel}" onclick="{! c.ReprocessLeads }" iconName="utility:check" iconPosition="left" disabled="{!v.buttonLabel == 'Running...'}" />


                                        <lightning:button label="Close" title="Close" onclick="{! c.openCloseUnprocessedModal }" iconName="utility:close" iconPosition="left" disabled="{!v.buttonLabel == 'Running...'}" />
                                    </footer>

                                </div>
                            </section>
                            <div class="slds-backdrop slds-backdrop_open"></div>
                        </aura:if>
                    </div>
                </div>
                <aura:set attribute="else">
                    <c:CS_SpendPeriodWithMarketCampaigns createCampaign="{!v.createCampaign}" campaignList="{!v.campaignList}" isEditing="{!v.isEditing}" spendPeriodList="{!v.filteredSpendPeriodList}" campaignInstance="{!v.campaignInstance}" picklistOptions="{!v.picklistOptions}"
                    />
                </aura:set>
            </aura:if>
        </div>

    </div>
</aura:component>