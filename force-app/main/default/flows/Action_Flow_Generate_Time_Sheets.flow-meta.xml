<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>Send_Email</name>
        <label>Send Email</label>
        <locationX>1634</locationX>
        <locationY>242</locationY>
        <actionName>emailSimple</actionName>
        <actionType>emailSimple</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>emailAddresses</name>
            <value>
                <stringValue>teknik@dinfamiliejurist.dk</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderType</name>
            <value>
                <stringValue>OrgWideEmailAddress</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderAddress</name>
            <value>
                <stringValue>no-reply@dinfamiliejurist.dk</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailSubject</name>
            <value>
                <elementReference>EmailSubject</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailBody</name>
            <value>
                <elementReference>EmailBody</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>sendRichBody</name>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputParameters>
        <nameSegment>emailSimple</nameSegment>
        <offset>0</offset>
    </actionCalls>
    <apiVersion>60.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <assignments>
        <name>Assign_Custom_Error_Country_Missing</name>
        <label>Assign Custom Error &quot;Country Missing&quot;</label>
        <locationX>842</locationX>
        <locationY>350</locationY>
        <assignmentItems>
            <assignToReference>CustomError</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Country Missing</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <isGoTo>true</isGoTo>
            <targetReference>Send_Email</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Danish_Values_to_Variables</name>
        <label>Assign Danish Values to Variables</label>
        <locationX>50</locationX>
        <locationY>350</locationY>
        <assignmentItems>
            <assignToReference>varTemplateRecordId</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>a15W5000000Ex0DIAS</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varCountry</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Denmark</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varCurrency</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>DKK</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_Time_Sheets_from_Template</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Record_to_Time_Sheet_Collection</name>
        <label>Assign Record to Time Sheet Collection</label>
        <locationX>534</locationX>
        <locationY>932</locationY>
        <assignmentItems>
            <assignToReference>timeSheetCollection</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>timeSheetRecord</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Time_Sheets</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Spanish_Values_to_Variables</name>
        <label>Assign Spanish Values to Variables</label>
        <locationX>578</locationX>
        <locationY>350</locationY>
        <assignmentItems>
            <assignToReference>varTemplateRecordId</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>a15W5000001CCzJIAW</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varCountry</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Spain</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varCurrency</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>DKK</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_Time_Sheets_from_Template</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Swedish_Values_to_Variables</name>
        <label>Assign Swedish Values to Variables</label>
        <locationX>314</locationX>
        <locationY>350</locationY>
        <assignmentItems>
            <assignToReference>varTemplateRecordId</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>a15W5000001CC1dIAG</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varCountry</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Sweden</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varCurrency</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>SEK</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_Time_Sheets_from_Template</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Populate_Time_Sheet_Record_Variable</name>
        <label>Populate Time Sheet Record Variable</label>
        <locationX>534</locationX>
        <locationY>824</locationY>
        <assignmentItems>
            <assignToReference>timeSheetRecord.Country__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>varCountry</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>timeSheetRecord.CurrencyIsoCode</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>varCurrency</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>timeSheetRecord.Default_Hours_in_Workday__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>inputEmployeeId.Default_Work_Hours_Per_Day__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>timeSheetRecord.Employee__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>inputEmployeeId.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>timeSheetRecord.Market_Unit__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>inputEmployeeId.Market_Tnit__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>timeSheetRecord.Month_Year__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Time_Sheets.Month_Year__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>timeSheetRecord.Name</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Time_Sheets.Name</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>timeSheetRecord.Potential_Work_Days__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Time_Sheets.Potential_Work_Days__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>timeSheetRecord.Employee_s_Salesforce_User__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>inputEmployeeId.SF_User__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>timeSheetRecord.Employee_s_Manager__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>inputEmployeeId.Manager__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>timeSheetRecord.Employee_Country__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>varCountry</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Assign_Record_to_Time_Sheet_Collection</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Which_Country_is_the_Employee_Working_In</name>
        <label>Which Country is the Employee Working In?</label>
        <locationX>446</locationX>
        <locationY>242</locationY>
        <defaultConnector>
            <targetReference>Assign_Custom_Error_Country_Missing</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Denmark</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>Get_Employee_s_SF_User.Team__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>DK</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Get_Employee_s_SF_User.Team__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>N/A</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_Danish_Values_to_Variables</targetReference>
            </connector>
            <label>Denmark</label>
        </rules>
        <rules>
            <name>Sweden</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_Employee_s_SF_User.Team__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>SE</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_Swedish_Values_to_Variables</targetReference>
            </connector>
            <label>Sweden</label>
        </rules>
        <rules>
            <name>Spain</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>Get_Employee_s_SF_User.Team__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>ES - DK</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Get_Employee_s_SF_User.Team__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>ES - SE</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_Spanish_Values_to_Variables</targetReference>
            </connector>
            <label>Spain</label>
        </rules>
    </decisions>
    <environments>Default</environments>
    <formulas>
        <name>frmFirstOfStartMonth</name>
        <dataType>Date</dataType>
        <expression>DATE(YEAR({!inputEmployeeId.Start_Date__c}), MONTH({!inputEmployeeId.Start_Date__c}), 1)</expression>
    </formulas>
    <interviewLabel>Action Flow:: Generate Time Sheets {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Action Flow: Generate Time Sheets</label>
    <loops>
        <name>Loop_Time_Sheets</name>
        <label>Loop Time Sheets</label>
        <locationX>446</locationX>
        <locationY>716</locationY>
        <collectionReference>Get_Time_Sheets_from_Template</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Populate_Time_Sheet_Record_Variable</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Create_Copy_of_Template_Time_Sheet</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <name>Create_Copy_of_Template_Time_Sheet</name>
        <label>Create Copy of Template Time Sheet</label>
        <locationX>446</locationX>
        <locationY>1124</locationY>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Send_Email</targetReference>
        </faultConnector>
        <inputReference>timeSheetCollection</inputReference>
    </recordCreates>
    <recordLookups>
        <name>Get_Employee_s_SF_User</name>
        <label>Get Employee&apos;s SF User</label>
        <locationX>446</locationX>
        <locationY>134</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Which_Country_is_the_Employee_Working_In</targetReference>
        </connector>
        <faultConnector>
            <targetReference>Send_Email</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>inputEmployeeId.SF_User__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>User</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Time_Sheets_from_Template</name>
        <label>Get Time Sheets from Template</label>
        <locationX>446</locationX>
        <locationY>608</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_Time_Sheets</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Send_Email</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Country__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>varCountry</elementReference>
            </value>
        </filters>
        <filters>
            <field>Employee__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>varTemplateRecordId</elementReference>
            </value>
        </filters>
        <filters>
            <field>Month_Year__c</field>
            <operator>GreaterThanOrEqualTo</operator>
            <value>
                <elementReference>frmFirstOfStartMonth</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>Time_Sheet__c</object>
        <sortField>Month_Year__c</sortField>
        <sortOrder>Asc</sortOrder>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <start>
        <locationX>320</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Get_Employee_s_SF_User</targetReference>
        </connector>
    </start>
    <status>Obsolete</status>
    <textTemplates>
        <name>EmailBody</name>
        <isViewedAsPlainText>false</isViewedAsPlainText>
        <text>&lt;p&gt;An Error Occured in the flow &quot;Action Flow:: Generate Time Sheets&quot;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Processing User: {!$User.FirstName} {!$User.LastName}&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Fault Message:&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;{!$Flow.FaultMessage}&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;CustomError:&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;{!CustomError}&lt;/p&gt;</text>
    </textTemplates>
    <textTemplates>
        <name>EmailSubject</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>An Error Occured when Generating Time Sheets</text>
    </textTemplates>
    <variables>
        <name>CustomError</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <stringValue>No CustomError Provided</stringValue>
        </value>
    </variables>
    <variables>
        <name>inputEmployeeId</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <objectType>SFDC_Employee__c</objectType>
    </variables>
    <variables>
        <name>timeSheetCollection</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
        <objectType>Time_Sheet__c</objectType>
    </variables>
    <variables>
        <name>timeSheetRecord</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
        <objectType>Time_Sheet__c</objectType>
    </variables>
    <variables>
        <name>varCountry</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>varCurrency</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>varTemplateRecordId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>
