<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>60.0</apiVersion>
    <assignments>
        <name>Assign_Custom_Error_Country_Missing</name>
        <label>Assign Custom Error &quot;Country Missing&quot;</label>
        <locationX>1106</locationX>
        <locationY>350</locationY>
        <assignmentItems>
            <assignToReference>CustomError</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Country Missing</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <isGoTo>true</isGoTo>
            <targetReference>AL_Send_Error_Email_from_Input_Values_Flow</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Danish_Values_to_Variables</name>
        <label>Assign Danish Values to Variables</label>
        <locationX>50</locationX>
        <locationY>350</locationY>
        <assignmentItems>
            <assignToReference>varTemplateRecordId</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>a15W5000000Ex0DIAS</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varCurrency</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>DKK</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_Time_Sheets_from_Template</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Uses a Spanish Template for now, not sure if it matters yet</description>
        <name>Assign_Irish_Values_to_Variables</name>
        <label>Assign Irish Values to Variables</label>
        <locationX>842</locationX>
        <locationY>350</locationY>
        <assignmentItems>
            <assignToReference>varTemplateRecordId</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>a15W5000001CCzJIAW</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varCurrency</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>EUR</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_Time_Sheets_from_Template</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Uses DKK as Currency</description>
        <name>Assign_Spanish_Values_to_Variables</name>
        <label>Assign Spanish Values to Variables</label>
        <locationX>578</locationX>
        <locationY>350</locationY>
        <assignmentItems>
            <assignToReference>varTemplateRecordId</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>a15W5000001CCzJIAW</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varCurrency</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>DKK</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_Time_Sheets_from_Template</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Swedish_Values_to_Variables</name>
        <label>Assign Swedish Values to Variables</label>
        <locationX>314</locationX>
        <locationY>350</locationY>
        <assignmentItems>
            <assignToReference>varTemplateRecordId</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>a15W5000001CC1dIAG</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varCurrency</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>SEK</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_Time_Sheets_from_Template</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Populate_Custom_Error_with_Flow_Fault_Message</name>
        <label>Populate Custom Error with Flow Fault Message</label>
        <locationX>2426</locationX>
        <locationY>242</locationY>
        <assignmentItems>
            <assignToReference>CustomError</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Flow.FaultMessage</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>AL_Send_Error_Email_from_Input_Values_Flow</targetReference>
        </connector>
    </assignments>
    <collectionProcessors>
        <name>Filter_Days</name>
        <elementSubtype>FilterCollectionProcessor</elementSubtype>
        <label>Filter Days</label>
        <locationX>666</locationX>
        <locationY>1148</locationY>
        <assignNextValueToReference>currentItem_Filter_Days</assignNextValueToReference>
        <collectionProcessorType>FilterCollectionProcessor</collectionProcessorType>
        <collectionReference>Get_Days</collectionReference>
        <conditionLogic>and</conditionLogic>
        <conditions>
            <leftValueReference>currentItem_Filter_Days.Month_Year__c</leftValueReference>
            <operator>EqualTo</operator>
            <rightValue>
                <elementReference>Loop_Time_Sheets.Work_Month__c</elementReference>
            </rightValue>
        </conditions>
        <connector>
            <targetReference>Transform_Days_into_Attendance</targetReference>
        </connector>
    </collectionProcessors>
    <decisions>
        <name>Which_Country_is_the_Employee_Working_In</name>
        <label>Which Country is the Employee Working In?</label>
        <locationX>578</locationX>
        <locationY>242</locationY>
        <defaultConnector>
            <targetReference>Assign_Custom_Error_Country_Missing</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Denmark</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>Get_User.Country__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Denmark</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_Danish_Values_to_Variables</targetReference>
            </connector>
            <label>Denmark</label>
        </rules>
        <rules>
            <name>Sweden</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_User.Country__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Sweden</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_Swedish_Values_to_Variables</targetReference>
            </connector>
            <label>Sweden</label>
        </rules>
        <rules>
            <name>Spain</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>Get_User.Country__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Spain</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_Spanish_Values_to_Variables</targetReference>
            </connector>
            <label>Spain</label>
        </rules>
        <rules>
            <name>Ireland</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_User.Country__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Ireland</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_Irish_Values_to_Variables</targetReference>
            </connector>
            <label>Ireland</label>
        </rules>
    </decisions>
    <description>Uses a Transform Element to Generate Time Sheets from a Template Time Sheet Record</description>
    <environments>Default</environments>
    <formulas>
        <name>frmFirstOfStartMonth</name>
        <dataType>Date</dataType>
        <expression>DATE(YEAR({!Employee.Start_Date__c}), MONTH({!Employee.Start_Date__c}), 1)</expression>
    </formulas>
    <interviewLabel>AL - Create Time Sheets {!$Flow.CurrentDateTime}</interviewLabel>
    <label>AL - Create Time Sheets</label>
    <loops>
        <name>Loop_Time_Sheets</name>
        <label>Loop Time Sheets</label>
        <locationX>578</locationX>
        <locationY>1040</locationY>
        <collectionReference>Transform_Time_Sheets</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Filter_Days</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Create_Attendance_Records</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <name>Create_Attendance_Records</name>
        <label>Create Attendance Records</label>
        <locationX>578</locationX>
        <locationY>1448</locationY>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Populate_Custom_Error_with_Flow_Fault_Message</targetReference>
        </faultConnector>
        <inputReference>Transform_Days_into_Attendance</inputReference>
    </recordCreates>
    <recordCreates>
        <name>Create_Time_Sheets</name>
        <label>Create Time Sheets</label>
        <locationX>578</locationX>
        <locationY>824</locationY>
        <connector>
            <targetReference>Get_Days</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Populate_Custom_Error_with_Flow_Fault_Message</targetReference>
        </faultConnector>
        <inputReference>Transform_Time_Sheets</inputReference>
    </recordCreates>
    <recordLookups>
        <name>Get_Days</name>
        <label>Get Days</label>
        <locationX>578</locationX>
        <locationY>932</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_Time_Sheets</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Populate_Custom_Error_with_Flow_Fault_Message</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Date__c</field>
            <operator>GreaterThanOrEqualTo</operator>
            <value>
                <elementReference>Employee.Start_Date__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>Day__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Time_Sheets_from_Template</name>
        <label>Get Time Sheets from Template</label>
        <locationX>578</locationX>
        <locationY>608</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Transform_Time_Sheets</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Populate_Custom_Error_with_Flow_Fault_Message</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Country__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Get_User.Country__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>Employee__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>varTemplateRecordId</elementReference>
            </value>
        </filters>
        <filters>
            <field>Month_Year__c</field>
            <operator>GreaterThanOrEqualTo</operator>
            <value>
                <elementReference>frmFirstOfStartMonth</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>Time_Sheet__c</object>
        <sortField>Month_Year__c</sortField>
        <sortOrder>Asc</sortOrder>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Find&apos;s the Employee&apos;s SF User</description>
        <name>Get_User</name>
        <label>Get User</label>
        <locationX>578</locationX>
        <locationY>134</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Which_Country_is_the_Employee_Working_In</targetReference>
        </connector>
        <faultConnector>
            <targetReference>Populate_Custom_Error_with_Flow_Fault_Message</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Employee.SF_User__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>User</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <start>
        <locationX>452</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Get_User</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <subflows>
        <name>AL_Send_Error_Email_from_Input_Values_Flow</name>
        <label>AL - Send Error Email from Input Values Flow</label>
        <locationX>2426</locationX>
        <locationY>350</locationY>
        <flowName>AL_Send_Error_Email_from_Input_Values</flowName>
        <inputAssignments>
            <name>inputCustomError</name>
            <value>
                <elementReference>CustomError</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>inputFlowName</name>
            <value>
                <stringValue>AL - Create Time Sheets</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>inputRecordId</name>
            <value>
                <elementReference>Employee.Id</elementReference>
            </value>
        </inputAssignments>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </subflows>
    <textTemplates>
        <name>EmailBody</name>
        <isViewedAsPlainText>false</isViewedAsPlainText>
        <text>&lt;p&gt;An Error Occured in the flow &quot;Action Flow:: Generate Time Sheets&quot;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Processing User: {!$User.FirstName} {!$User.LastName}&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Fault Message:&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;{!$Flow.FaultMessage}&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;CustomError:&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;{!CustomError}&lt;/p&gt;</text>
    </textTemplates>
    <textTemplates>
        <name>EmailSubject</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>An Error Occured when Generating Time Sheets</text>
    </textTemplates>
    <transforms>
        <name>Transform_Days_into_Attendance</name>
        <label>Transform Days into Attendance</label>
        <locationX>666</locationX>
        <locationY>1256</locationY>
        <connector>
            <targetReference>Loop_Time_Sheets</targetReference>
        </connector>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <objectType>Attendance__c</objectType>
        <scale>0</scale>
        <transformValues>
            <transformValueActions>
                <outputFieldApiName>Date__c</outputFieldApiName>
                <transformType>Map</transformType>
                <value>
                    <elementReference>Filter_Days[$EachItem].Date__c</elementReference>
                </value>
            </transformValueActions>
            <transformValueActions>
                <outputFieldApiName>Country__c</outputFieldApiName>
                <transformType>Map</transformType>
                <value>
                    <elementReference>Employee.Country__c</elementReference>
                </value>
            </transformValueActions>
            <transformValueActions>
                <outputFieldApiName>Day__c</outputFieldApiName>
                <transformType>Map</transformType>
                <value>
                    <elementReference>Filter_Days[$EachItem].Id</elementReference>
                </value>
            </transformValueActions>
            <transformValueActions>
                <outputFieldApiName>Employee__c</outputFieldApiName>
                <transformType>Map</transformType>
                <value>
                    <elementReference>Employee.Id</elementReference>
                </value>
            </transformValueActions>
            <transformValueActions>
                <outputFieldApiName>Employee_s_Salesforce_User__c</outputFieldApiName>
                <transformType>Map</transformType>
                <value>
                    <elementReference>Employee.SF_User__c</elementReference>
                </value>
            </transformValueActions>
            <transformValueActions>
                <outputFieldApiName>Name</outputFieldApiName>
                <transformType>Map</transformType>
                <value>
                    <elementReference>Filter_Days[$EachItem].Name</elementReference>
                </value>
            </transformValueActions>
            <transformValueActions>
                <outputFieldApiName>Time_Sheet__c</outputFieldApiName>
                <transformType>Map</transformType>
                <value>
                    <elementReference>Loop_Time_Sheets.Id</elementReference>
                </value>
            </transformValueActions>
        </transformValues>
    </transforms>
    <transforms>
        <name>Transform_Time_Sheets</name>
        <label>Transform Time Sheets</label>
        <locationX>578</locationX>
        <locationY>716</locationY>
        <connector>
            <targetReference>Create_Time_Sheets</targetReference>
        </connector>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <objectType>Time_Sheet__c</objectType>
        <scale>0</scale>
        <transformValues>
            <transformValueActions>
                <outputFieldApiName>Month_Year__c</outputFieldApiName>
                <transformType>Map</transformType>
                <value>
                    <elementReference>Get_Time_Sheets_from_Template[$EachItem].Month_Year__c</elementReference>
                </value>
            </transformValueActions>
            <transformValueActions>
                <outputFieldApiName>Name</outputFieldApiName>
                <transformType>Map</transformType>
                <value>
                    <elementReference>Get_Time_Sheets_from_Template[$EachItem].Name</elementReference>
                </value>
            </transformValueActions>
            <transformValueActions>
                <outputFieldApiName>Potential_Work_Days__c</outputFieldApiName>
                <transformType>Map</transformType>
                <value>
                    <elementReference>Get_Time_Sheets_from_Template[$EachItem].Potential_Work_Days__c</elementReference>
                </value>
            </transformValueActions>
            <transformValueActions>
                <outputFieldApiName>CurrencyIsoCode</outputFieldApiName>
                <transformType>Map</transformType>
                <value>
                    <elementReference>varCurrency</elementReference>
                </value>
            </transformValueActions>
            <transformValueActions>
                <outputFieldApiName>Default_Hours_in_Workday__c</outputFieldApiName>
                <transformType>Map</transformType>
                <value>
                    <elementReference>Employee.Default_Work_Hours_Per_Day__c</elementReference>
                </value>
            </transformValueActions>
            <transformValueActions>
                <outputFieldApiName>Employee__c</outputFieldApiName>
                <transformType>Map</transformType>
                <value>
                    <elementReference>Employee.Id</elementReference>
                </value>
            </transformValueActions>
            <transformValueActions>
                <outputFieldApiName>Market_Unit__c</outputFieldApiName>
                <transformType>Map</transformType>
                <value>
                    <elementReference>Employee.Market_Tnit__c</elementReference>
                </value>
            </transformValueActions>
            <transformValueActions>
                <outputFieldApiName>Employee_s_Salesforce_User__c</outputFieldApiName>
                <transformType>Map</transformType>
                <value>
                    <elementReference>Employee.SF_User__c</elementReference>
                </value>
            </transformValueActions>
            <transformValueActions>
                <outputFieldApiName>Employee_s_Manager__c</outputFieldApiName>
                <transformType>Map</transformType>
                <value>
                    <elementReference>Employee.Manager__c</elementReference>
                </value>
            </transformValueActions>
            <transformValueActions>
                <outputFieldApiName>Country__c</outputFieldApiName>
                <transformType>Map</transformType>
                <value>
                    <elementReference>Employee.Country__c</elementReference>
                </value>
            </transformValueActions>
        </transformValues>
    </transforms>
    <variables>
        <name>currentItem_Filter_Days</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Day__c</objectType>
    </variables>
    <variables>
        <name>CustomError</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <stringValue>No CustomError Provided</stringValue>
        </value>
    </variables>
    <variables>
        <name>Employee</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <objectType>SFDC_Employee__c</objectType>
    </variables>
    <variables>
        <name>TimeSheet</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
        <objectType>Time_Sheet__c</objectType>
    </variables>
    <variables>
        <name>TimeSheetCollection</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
        <objectType>Time_Sheet__c</objectType>
    </variables>
    <variables>
        <name>varCurrency</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>varTemplateRecordId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>
